<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <title>Receptjes Moutstraat</title>
        <link rel="stylesheet" href="assets/css/main.css" />
        <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
        <style>
        #header { display: none; }

        #footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #333;
            color: white;
            box-shadow: 0px -3px 6px rgba(0, 0, 0, 0.1);
            font-size: 14px;
            z-index: 100;
        }

        .search-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-container select, 
        .search-container input,
        #filterBtn {
            padding: 5px 10px;
            height: 30px;
            line-height: 20px;
            font-size: 14px;
            background: #555;
            color: white;
            border: none;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #filterBtn {
            text-transform: capitalize;
            width: 60px;
        }

        #filterMenu {
            display: none;
            position: fixed;
            right: 20px;
            bottom: 70px;
            background: #333;
            color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 101;
            max-height: 80vh;
            overflow-y: auto;
        }

        .filter-category {
            margin-bottom: 10px;
        }

        .filter-category h3 {
            margin-bottom: 5px;
        }

        .filter-option {
            background: #555;
            color: white;
            border: none;
            width: auto;
            height: 30px;
            padding: 0 10px;
            margin: 5px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            text-align: center;
            text-transform: none;
        }

        .filter-option.active {
            background: #555;
            border: 2px solid #fff;
        }

        #main {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px;
            margin-bottom: 120px;
            margin-right: auto;
            margin-left: auto;
            max-width: 2160px;
            justify-content: flex-start;
        }

        .thumb {
            flex: 0 0 calc(33.33% - 14px);
            max-width: calc(33.33% - 14px);
            margin: 0;
        }

        .thumb img {
            width: 100%;
            border-radius: 8px;
        }

        .thumb h2 { 
            text-align: center; 
            font-size: 18px; 
            margin-top: 10px; 
        }

        @media (max-width: 1200px) {
            .thumb {
                flex: 0 0 calc(50% - 10px);
                max-width: calc(50% - 10px);
            }
        }

        @media (max-width: 480px) {
            .thumb {
                flex: 0 0 100%;
                max-width: 100%;
            }
            #main {
                padding: 10px;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div id="main"></div>

    <footer id="footer">
        <div class="search-container">
            <select id="searchType">
                <option value="name">Search by Name</option>
                <option value="ingredients">Search by Ingredients</option>
            </select>
            <input type="text" id="searchInput" placeholder="Search recipes...">
        </div>
        <button id="filterBtn">Filter</button>
        <div id="filterMenu">
            <div class="filter-category">
                <h3>Type</h3>
                <button class="filter-option" data-category="Type" data-value="Meal">ğŸ½ï¸Meal</button>
                <button class="filter-option" data-category="Type" data-value="Side">ğŸ¥—Side</button>
                <button class="filter-option" data-category="Type" data-value="Soup">ğŸ²Soup</button>
				<button class="filter-option" data-category="Type" data-value="Bread">ğŸBread</button>
                <button class="filter-option" data-category="Type" data-value="Dessert">ğŸ°Dessert</button>
                <button class="filter-option" data-category="Type" data-value="Drink">ğŸ¹Drink</button>
                <button class="filter-option" data-category="Type" data-value="Sauce">ğŸ¥«Sauce</button>
				<button class="filter-option" data-category="Type" data-value="Other">ğŸ«™Other</button>
            </div>
            <div class="filter-category">
                <h3>Protein</h3>
                <button class="filter-option" data-category="Protein" data-value="Pork">ğŸ¥“Pork</button>
                <button class="filter-option" data-category="Protein" data-value="Beef">ğŸ¥©Beef</button>
                <button class="filter-option" data-category="Protein" data-value="Chicken">ğŸ—Chicken</button>
                <button class="filter-option" data-category="Protein" data-value="Mince">ğŸ–Mince</button>
                <button class="filter-option" data-category="Protein" data-value="Sausage">ğŸŒ­Sausage</button>
                <button class="filter-option" data-category="Protein" data-value="Seafood">ğŸ¦Seafood</button>
                <button class="filter-option" data-category="Protein" data-value="Veggy">ğŸ¥¬Veggy</button>
            </div>
            <div class="filter-category">
                <h3>Cuisine</h3>
                <button class="filter-option" data-category="Cuisine" data-value="Japanese">ğŸ‡¯ğŸ‡µ</button>
                <button class="filter-option" data-category="Cuisine" data-value="American">ğŸ‡ºğŸ‡¸</button>
                <button class="filter-option" data-category="Cuisine" data-value="Chinese">ğŸ‡¨ğŸ‡³</button>
                <button class="filter-option" data-category="Cuisine" data-value="Korean">ğŸ‡°ğŸ‡·</button>
                <button class="filter-option" data-category="Cuisine" data-value="Belgian">ğŸ‡§ğŸ‡ª</button>
                <button class="filter-option" data-category="Cuisine" data-value="Italian">ğŸ‡®ğŸ‡¹</button>
                <button class="filter-option" data-category="Cuisine" data-value="Greek">ğŸ‡¬ğŸ‡·</button>
                <button class="filter-option" data-category="Cuisine" data-value="Turkish">ğŸ‡¹ğŸ‡·</button>
                <button class="filter-option" data-category="Cuisine" data-value="Argentinian">ğŸ‡¦ğŸ‡·</button>
                <button class="filter-option" data-category="Cuisine" data-value="English">ğŸ‡¬ğŸ‡§</button>
                <button class="filter-option" data-category="Cuisine" data-value="Vietnamese">ğŸ‡»ğŸ‡³</button>
                <button class="filter-option" data-category="Cuisine" data-value="Surinamese">ğŸ‡¸ğŸ‡·</button>
                <button class="filter-option" data-category="Cuisine" data-value="Armenian">ğŸ‡¦ğŸ‡²</button>
                <button class="filter-option" data-category="Cuisine" data-value="Mongolian">ğŸ‡²ğŸ‡³</button>
                <button class="filter-option" data-category="Cuisine" data-value="French">ğŸ‡«ğŸ‡·</button>
                <button class="filter-option" data-category="Cuisine" data-value="German">ğŸ‡©ğŸ‡ª</button>
                <button class="filter-option" data-category="Cuisine" data-value="Georgian">ğŸ‡¬ğŸ‡ª</button>
                <button class="filter-option" data-category="Cuisine" data-value="Indian">ğŸ‡®ğŸ‡³</button>
                <button class="filter-option" data-category="Cuisine" data-value="Laotian">ğŸ‡±ğŸ‡¦</button>
                <button class="filter-option" data-category="Cuisine" data-value="Polish">ğŸ‡µğŸ‡±</button>
                <button class="filter-option" data-category="Cuisine" data-value="Indonesian">ğŸ‡®ğŸ‡©</button>
                <button class="filter-option" data-category="Cuisine" data-value="Austrian">ğŸ‡¦ğŸ‡¹</button>
                <button class="filter-option" data-category="Cuisine" data-value="Taiwanese">ğŸ‡¹ğŸ‡¼</button>
                <button class="filter-option" data-category="Cuisine" data-value="Spanish">ğŸ‡ªğŸ‡¸</button>                
            </div>
            <button id="clearFilters" class="filter-option">Clear Filters</button>
        </div>
    </footer>

    <!DOCTYPE HTML>
    <!-- Previous HTML remains exactly the same until the script section -->
    <!-- Only showing the updated JavaScript portion since everything else remains unchanged -->
    <script>
document.addEventListener("DOMContentLoaded", async () => {
    const main = document.getElementById("main");
    const searchInput = document.getElementById("searchInput");
    const searchType = document.getElementById("searchType");
    const filterBtn = document.getElementById("filterBtn");
    const filterMenu = document.getElementById("filterMenu");
    const filterOptions = document.querySelectorAll(".filter-option:not(#clearFilters)");
    const clearFiltersBtn = document.getElementById("clearFilters");
    let activeFilters = new Map();
    let allRecipes = {};

    document.addEventListener("click", (event) => {
        if (!filterMenu.contains(event.target) && event.target !== filterBtn) {
            filterMenu.style.display = "none";
        }
    });

    filterBtn.addEventListener("click", (event) => {
        event.stopPropagation();
        filterMenu.style.display = filterMenu.style.display === "block" ? "none" : "block";
    });

    try {
        const response = await fetch("recipe_metadata.json");
        if (!response.ok) throw new Error("Failed to fetch recipe metadata");
        allRecipes = await response.json();
        renderRecipes(allRecipes);
    } catch (error) {
        main.innerHTML = "<p>Failed to load recipes.</p>";
        console.error(error);
    }

    function renderRecipes(filteredRecipes) {
        main.innerHTML = "";
        Object.keys(filteredRecipes).forEach(file => {
            const { title } = filteredRecipes[file];
            main.innerHTML += `
                <article class="thumb">
                    <a href="${file}"><img src="./images/recipe/${file.replace('.html', '.jpg')}" alt="${title}" /></a>
                    <h2><b>${title}</b></h2>
                </article>`;
        });
    }

    function applySearchAndFilters() {
        // First apply search
        const searchTerm = searchInput.value.toLowerCase().trim();
        const searchMethod = searchType.value;

        let filteredRecipes = Object.keys(allRecipes).filter(file => {
            const recipe = allRecipes[file];
            if (searchTerm === "") return true;

            if (searchMethod === "name") {
                return recipe.title.toLowerCase().includes(searchTerm);
            } else if (searchMethod === "ingredients") {
                return recipe.ingredients.some(ingredient => 
                    ingredient.toLowerCase().includes(searchTerm)
                );
            }
            return true;
        }).reduce((obj, key) => (obj[key] = allRecipes[key], obj), {});

        // Then apply filters
        if (activeFilters.size > 0) {
            filteredRecipes = Object.keys(filteredRecipes).filter(file => {
                const data = filteredRecipes[file];
                // Check if category exists and is an array
                if (!data.category || !Array.isArray(data.category)) return false;
                
                return Array.from(activeFilters.entries()).every(([category, values]) => {
                    return Array.from(values).some(value => 
                        data.category.includes(value)
                    );
                });
            }).reduce((obj, key) => (obj[key] = filteredRecipes[key], obj), {});
        }

        renderRecipes(filteredRecipes);
    }

    searchInput.addEventListener("input", applySearchAndFilters);
    searchType.addEventListener("change", applySearchAndFilters);

    filterOptions.forEach(button => {
        button.addEventListener("click", function() {
            const category = this.getAttribute("data-category");
            const value = this.getAttribute("data-value");
            
            if (!activeFilters.has(category)) {
                activeFilters.set(category, new Set());
            }
            
            const categoryFilters = activeFilters.get(category);
            if (categoryFilters.has(value)) {
                categoryFilters.delete(value);
                if (categoryFilters.size === 0) {
                    activeFilters.delete(category);
                }
                this.classList.remove("active");
            } else {
                categoryFilters.add(value);
                this.classList.add("active");
            }
            
            applySearchAndFilters();
        });
    });

    clearFiltersBtn.addEventListener("click", function() {
        activeFilters.clear();
        filterOptions.forEach(button => button.classList.remove("active"));
        applySearchAndFilters();
    });
});
    </script>
</body>
</html>